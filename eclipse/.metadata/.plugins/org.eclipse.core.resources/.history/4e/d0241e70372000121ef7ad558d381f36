package net.minecraft.src;

import java.io.File;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import org.lwjgl.input.Keyboard;

import net.minecraft.client.Minecraft;

public class GuiReplays extends GuiScreen {

	private final GuiScreen parentScreen;
	public List<GuiReplayElement> replaysList = new ArrayList<GuiReplayElement>();
	public int selectedReplay = -1;
	private GuiSlotReplay guislotreplay;
	
	public GuiReplays(GuiScreen parent) {
		parentScreen = parent;
	}
	
	@Override
	public void initGui() {
		replaysList.clear();
		File replaysDir = new File(Minecraft.getMinecraftDir(), "replay");
		if(!replaysDir.exists())
			replaysDir.mkdirs();
		File[] files = replaysDir.listFiles();
		for(int i = 0; i < files.length; ++i) {
			File f = files[i];
			if(f.isDirectory()) {
				try {
					GuiReplayElement replay = new GuiReplayElement(f);
					replaysList.add(replay);
				} catch (FileNotFoundException e) {
				} catch (IOException e) {
					e.printStackTrace();
				}
			}
		}
		Keyboard.enableRepeatEvents(true);
		controlList.clear();
		guislotreplay = new GuiSlotReplay(this);
		initGuiControls();
	}
	
	private void initGuiControls() {
		StringTranslate stringtranslate = StringTranslate.getInstance();

		controlList.add(new GuiButton(0, width / 2 + 4 + 76, height - 28, 75, 20, stringtranslate.translateKey("gui.cancel")));
	}
	
	protected void actionPerformed(GuiButton guibutton) {
		if(!guibutton.enabled) {
			return;
		}
		if(guibutton.id == 2) {
			String s = ((ServerNBTStorage) serverList.get(selectedServer)).name;
			if(s != null) {
				deleteClicked = true;
				StringTranslate stringtranslate = StringTranslate.getInstance();
				String s1 = stringtranslate.translateKey("selectServer.deleteQuestion");
				String s2 = (new StringBuilder()).append("'").append(s).append("' ").append(stringtranslate.translateKey("selectServer.deleteWarning")).toString();
				String s3 = stringtranslate.translateKey("selectServer.deleteButton");
				String s4 = stringtranslate.translateKey("gui.cancel");
				GuiYesNo guiyesno = new GuiYesNo(this, s1, s2, s3, s4, selectedServer);
				mc.displayGuiScreen(guiyesno);
			}
		} else if(guibutton.id == 1) {
			joinServer(selectedServer);
		} else if(guibutton.id == 4) {
			directClicked = true;
			mc.displayGuiScreen(new GuiScreenServerList(this, tempServer = new ServerNBTStorage(StatCollector.translateToLocal("selectServer.defaultName"), "")));
		} else if(guibutton.id == 3) {
			addClicked = true;
			mc.displayGuiScreen(new GuiScreenAddServer(this, tempServer = new ServerNBTStorage(StatCollector.translateToLocal("selectServer.defaultName"), "")));
		} else if(guibutton.id == 7) {
			editClicked = true;
			ServerNBTStorage servernbtstorage = (ServerNBTStorage) serverList.get(selectedServer);
			mc.displayGuiScreen(new GuiScreenAddServer(this, tempServer = new ServerNBTStorage(servernbtstorage.name, servernbtstorage.host)));
		} else if(guibutton.id == 0) {
			mc.displayGuiScreen(parentScreen);
		} else if(guibutton.id == 8) {
			mc.displayGuiScreen(new GuiMultiplayer(parentScreen));
		} else {
			serverSlotContainer.actionPerformed(guibutton);
		}
	}
	
	public void drawScreen(int i, int j, float f) {
		StringTranslate stringtranslate = StringTranslate.getInstance();
		drawDefaultBackground();
		guislotreplay.drawScreen(i, j, f);
		drawCenteredString(fontRenderer, stringtranslate.translateKey("replays.title"), width / 2, 20, 0xffffff);
		super.drawScreen(i, j, f);
	}
}
